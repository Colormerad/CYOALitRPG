<div class="game-container game-page-content">
  <div class="header">
    <h1>LitRPG Adventure</h1>
    <button class="back-button" (click)="goToCharacterSelect()">Back to Characters</button>
  </div>

  <div *ngIf="loading" class="loading">
    <p>Loading...</p>
  </div>

  <div *ngIf="error" class="error">
    <p>{{ error }}</p>
    <button (click)="loadPlayerProgress()">Try Again</button>
  </div>

  <!-- Death Screen -->
  <div *ngIf="!loading && !error && isDeathScreen" class="death-screen">
    <div class="death-content">
      <h2 class="death-title">{{ currentNode?.title || 'The End' }}</h2>
      <div class="death-text" [innerHTML]="currentNode?.content || 'Your journey has come to an end.'">
      </div>
      
      <div class="death-info" *ngIf="playerProgress?.metadata">
        <h3>Final Status</h3>
        <div class="metadata">
          <div *ngIf="playerProgress?.metadata.death_reason" class="metadata-item">
            <span class="label">Cause of Death:</span>
            <span class="value">{{ playerProgress?.metadata.death_reason }}</span>
          </div>
          <div *ngIf="playerProgress?.metadata.death_timestamp" class="metadata-item">
            <span class="label">Time of Death:</span>
            <span class="value">{{ playerProgress?.metadata.death_timestamp | date:'medium' }}</span>
          </div>
          <div *ngIf="playerProgress?.metadata.prompts_survived" class="metadata-item">
            <span class="label">Survived:</span>
            <span class="value">{{ playerProgress?.metadata.prompts_survived }} choices</span>
          </div>
        </div>
      </div>
      
      <div class="death-actions">
        <button class="grave-button" (click)="viewGrave()">View Grave</button>
        <button class="start-over-button" (click)="startOver()">Start Over</button>
      </div>
    </div>
  </div>

  <!-- Regular Game Content -->
  <div *ngIf="!loading && !error && currentNode && !isDeathScreen" class="story-content">
    <div class="story-node">
      <h2>{{ currentNode.title }}</h2>
      <div class="story-text" [innerHTML]="currentNode.content"></div>
    </div>

    <div *ngIf="currentNode.requiresInput" class="password-input">
      <h3>{{ currentNode.inputDescription || 'Enter Password' }}</h3>
      <div class="input-group">
        <input type="text" [(ngModel)]="passwordInput" placeholder="Enter your answer..." />
        <button (click)="submitPassword()">Submit</button>
      </div>
    </div>

    <div *ngIf="!currentNode.requiresInput" class="choices">
      <h3>What will you do?</h3>
      <div class="choice-list">
        <div *ngFor="let choice of choices" class="choice-item">
          <button (click)="makeChoice(choice.id || 0, choice)" class="choice-button">
            {{ choice.text }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="!loading && !error && playerProgress && !isDeathScreen" class="player-status">
    <div class="character-info">
      <h3>Character Status</h3>
      <div class="metadata" *ngIf="playerProgress?.metadata">
        <div *ngFor="let item of objectKeys(playerProgress?.metadata)" class="metadata-item">
          <span class="label">{{ formatMetadataKey(item) }}:</span>
          <span class="value">{{ playerProgress.metadata[item] }}</span>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Bottom spacer to prevent content from being cut off by menu -->
  <div class="bottom-spacer" style="height: 60px; width: 100%;"></div>
</div>
