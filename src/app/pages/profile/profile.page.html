<ion-header>
  <ion-toolbar class="retro-toolbar">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/character-select" class="pixel-button"></ion-back-button>
    </ion-buttons>
    <ion-title class="retro-header">Profile</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="retro-content scanlines">
  <div class="pixel-container">
    <h1 class="retro-header">Account Settings</h1>
    
    <!-- Loading state -->
    <div *ngIf="loading" class="loading-container">
      <div class="retro-text">Loading...</div>
      <div class="pixel-loader"></div>
    </div>
    
    <!-- Error state -->
    <div *ngIf="error" class="error-container">
      <div class="retro-text error-text">{{ error }}</div>
      <button class="pixel-button" (click)="loadAccountData()">Retry</button>
    </div>
    
    <!-- Account Info -->
    <div *ngIf="!loading && !error" class="account-section">
      <div class="pixel-art-container">
        <div class="pixel-art-avatar"></div>
      </div>
      
      <form [formGroup]="profileForm" (ngSubmit)="updateProfile()" class="profile-form">
        <!-- Username Field -->
        <div class="form-group">
          <label class="retro-label">Username</label>
          <input type="text" formControlName="username" class="pixel-input" [readonly]="!editMode" />
          <div *ngIf="profileForm.get('username')?.invalid && profileForm.get('username')?.touched" class="error-text">
            Username must be 3-20 characters
          </div>
        </div>
        
        <!-- Email Field -->
        <div class="form-group">
          <label class="retro-label">Email</label>
          <input type="email" formControlName="email" class="pixel-input" [readonly]="!editMode" />
          <div *ngIf="profileForm.get('email')?.invalid && profileForm.get('email')?.touched" class="error-text">
            Please enter a valid email
          </div>
        </div>
        
        <!-- Password Fields (only shown in edit mode) -->
        <div *ngIf="editMode" class="form-group">
          <label class="retro-label">New Password</label>
          <input type="password" formControlName="password" class="pixel-input" />
          <div *ngIf="profileForm.get('password')?.invalid && profileForm.get('password')?.touched" class="error-text">
            Password must be at least 6 characters
          </div>
        </div>
        
        <div *ngIf="editMode" class="form-group">
          <label class="retro-label">Confirm Password</label>
          <input type="password" formControlName="confirmPassword" class="pixel-input" />
          <div *ngIf="passwordsDoNotMatch()" class="error-text">
            Passwords do not match
          </div>
        </div>
        
        <!-- Account Stats -->
        <div class="account-stats">
          <div class="stat-item">
            <span class="retro-label">Account Created:</span>
            <span class="retro-text">{{ accountCreatedDate }}</span>
          </div>
          <div class="stat-item">
            <span class="retro-label">Characters:</span>
            <span class="retro-text">{{ characterCount }}</span>
          </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="action-buttons">
          <button *ngIf="!editMode" type="button" class="pixel-button edit-btn" (click)="toggleEditMode()">
            Edit Profile
          </button>
          <button *ngIf="editMode" type="submit" class="pixel-button save-btn" [disabled]="profileForm.invalid || passwordsDoNotMatch()">
            Save Changes
          </button>
          <button *ngIf="editMode" type="button" class="pixel-button cancel-btn" (click)="cancelEdit()">
            Cancel
          </button>
          <button type="button" class="pixel-button logout-btn" (click)="this.logout()">
            Logout
          </button>
        </div>
      </form>
    </div>
    
    <!-- Audio Controls Section -->
    <div class="audio-controls" *ngIf="!loading && !error">
      <h2 class="retro-header">Audio Settings</h2>
      <!-- Added audio controls section for volume and mute functionality -->
      <div class="control-group">
        <label class="retro-label">Volume</label>
        <ion-range [value]="volume" (ionChange)="setVolume($event.detail.value)" min="0" max="1" step="0.01">
          <ion-icon slot="start" name="volume-low"></ion-icon>
          <ion-icon slot="end" name="volume-high"></ion-icon>
        </ion-range>
      </div>
      <div class="control-group">
        <ion-button [class.muted]="isMuted" (click)="toggleMute()">
          <ion-icon [name]="isMuted ? 'volume-mute' : 'volume-medium'" slot="start"></ion-icon>
          <span>{{ isMuted ? 'Unmute' : 'Mute' }}</span>
        </ion-button>
      </div>
    </div>
  </div>
</ion-content>
